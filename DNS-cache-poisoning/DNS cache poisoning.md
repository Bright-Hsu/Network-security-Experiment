# DNS cache poisoning

## 实验目的

1. 了解 hosts 文件和 DNS 系统的关系。

2. 使用 DNS 攻击工具进行 DNS 投毒，观察攻击情况，了解 DNS 攻击原理。

## 实验环境

Server：ubuntu虚拟机，安装DNS服务器bind9

Attacker：ubuntu虚拟机，与server处于同一网段（局域网）

## 实验原理

目前DNS采用UDP协议传输查询和应答数据包，采用简单信任机制，对首先收到的DNS应答数据包仅进行原查询包发送IP地址、端口和ID的确认，而不会对数据包的合法性做任何分析，若匹配，则接受其为正确应答数据包，继续DNS解析过程，并且丢弃后续到达的所有应答数据包。这就使得攻击者可以仿冒权威DNS服务器向缓存DNS服务器发送伪造应答包，力争抢先完成应答以污染DNS缓存。若攻击者发送的伪造应答包在权威名字服务器发送的正确应答包之前到达缓存DNS服务器，并与原查询包IP地址、端口、ID相匹配，就能够成功污染DNS缓存。

DNS缓存投毒是指一些刻意制造（投毒）或无意中制造（污染）出来的DNS数据包，让DNS缓存服务器缓存了错误的域名解析记录。

  DNS缓存投毒工作方式是：由于通常的DNS查询没有任何认证机制，而且DNS查询通常基于的UDP是无连接不可靠的协议，因此DNS的查询非常容易被篡改，通过对UDP端口上的DNS查询进行监听，一经发现与关键词相匹配的请求则立即伪装成目标域名的解析服务器（NS，Name Server）给查询者返回错误结果。为了减少网络上的流量，一般的DNS缓存服务器都会把域名数据缓存起来，待下次有其他DNS客户端要求解析同样的域名时，可以立即提供服务。当缓存服务器缓存了错误的域名数据时，DNS客户端在请求这些域名时就会得到错误的结果。

## 实验步骤