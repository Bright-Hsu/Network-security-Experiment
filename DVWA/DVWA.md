# DVWA靶场实验

## 实验目的

1. 搭建安全靶场，熟悉常见的WEB安全漏洞；

2. 了解并掌握相关工具寻找漏洞及注入点；

3. 掌握漏洞的保护方式。

## 实验环境

1. 两个基于VMware的Ubuntu18.04虚拟机；

2. DVWA（Damn Vulnerable Web App）靶场；

## 实验内容

1. DVWA靶场搭建

安装xampp和DVWA文件，并进行环境配置。

2. 爆破登陆

使用burp suite工具拦截包并使用字典暴力破解密码登陆。

3. SQL注入

了解SQL注入原理并利用漏洞进行登录。

## 实验原理

DVWA (Dam Vulnerable Web Application)是用PHP + MySQL编写的一套用于常规WEB漏洞教学和检测的WEB脆弱性测试程序，包含了SQL注入、XSS、盲注等常见的一些安全漏洞。其主要目标是帮助安全专业人员在法律环境中测试他们的技能和工具，帮助Web开发人员更好地了解保护Web应用程序的过程，并帮助学生和教师了解受控类中的Web应用程序安全性房间测试环境。

本次实验我们要实现的是Brute Force（暴力破解）、SQL Injection（SQL注入），还有ARP欺骗。

Brute Force（暴力破解）是指黑客利用密码字典，使用穷举法猜解出用户口令，是现在最为广泛使用的攻击手法之一。一般指穷举法，穷举法的基本思想是根据题目的部分条件确定答案的大致范围，并在此范围内对所有可能的情况逐一验证，直到全部情况验证完毕。若某个情况验证符合题目的全部条件，则为本问题的一个解；若全部情况验证后都不符合题目的全部条件，则本题无解。

SQL Injection（SQL注入）是发生在 Web 程序中数据库层的安全漏洞，是网站存在最多也是最简单的漏洞。主要原因是程序对用户输入数据的合法性没有判断和处理，导致攻击者可以在 Web 应用程序中事先定义好的 SQL 语句中添加额外的 SQL 语句，在管理员不知情的情况下实现非法操作，以此来实现欺骗数据库服务器执行非授权的任意查询，从而进一步获取到数据信息。

## 实验步骤

### 1. Brute Force（暴力破解）

首先，我们修改了浏览器的代理ip，ip为127.0.0.1，端口为8080。同时将No proxy for 中的内容删去。

然后访问127.0.0.1/DVWA/vulnerabilities/brute/index.php,可以看到xampp拦截到了下列包。

![image-20220407235442251](https://gitee.com/bright_xu/blog-image/raw/master/202204072354382.png)

接下来随便填写一个账号密码，这里输入账号abcd，密码12345，然后提交登录，软件拦截到了包，并且发现账号和密码是明文传输的，可以直接抓取到：

![image-20220407235507282](https://gitee.com/bright_xu/blog-image/raw/master/202204072355319.png)

  参数列表如下，此时是安全等级是low：

![image-20220407235537952](https://gitee.com/bright_xu/blog-image/raw/master/202204072355993.png)

然后点击action 选择 send to Intruder ,将包发送到Intruder模块，准备构造爆破包。该模块默认会将所有参数自动标记，我们在low模式下只需要爆破密码。首先看到自动标记的参数如下：

![图形用户界面, 文本, 应用程序, 电子邮件  描述已自动生成](https://gitee.com/bright_xu/blog-image/raw/master/img/clip_image008.png)

点击clear先清除自动标记的参数，然后手动选中密码，按add标记参数，如下图所示。

![image-20220407235606860](https://gitee.com/bright_xu/blog-image/raw/master/202204072356969.png)

然后点击payload标签，在simple list中添加字典，随便填加几个，添加完成后点击start attack。然后查看结果，发现有一个包返回的长度跟别的都不一样，就是爆破正确的密码。从下图可以看出，密码就是password。

![image-20220407235629502](https://gitee.com/bright_xu/blog-image/raw/master/202204072356550.png)

然后将得到的密码输入网页中，可以看到登录成功：

![img](https://gitee.com/bright_xu/blog-image/raw/master/img/clip_image014.png)

### 2. SQL注入

引起SQL注入漏洞的原因，一般是由于web服务没有对传递的数据中的关键词过滤导致的。在用户的输入有转义字符时 ，它会被传递给一个SQL 语句。这样就会导致应用程序的终端用户对数据库上的语句实施操纵 。

登入DVWA中的暴力破解一栏，在用户名一栏输入 admin’ or ‘1’=‘1 ,密码留空，发现还是可以成功登陆，说明该页面存在SQL注入漏洞，登录成功截图如下：

![图形用户界面, 文本, 应用程序, 电子邮件  描述已自动生成](https://gitee.com/bright_xu/blog-image/raw/master/img/clip_image002.png)

## 实验思考

防范方式

### **1.** **Brute Force**（暴力破解）

防御措施主要有以下几条：

（1）加入token机制，既可以抵御CSRF攻击（Cross Site Request Forgery, 跨站域请求伪造），同时也增加了爆破的难度。

每次登录页面都会随机生成Token字串，那么无脑暴力破解就不可能了，因为Token是完全随机的。每次服务器返回的登陆页面中都会包含一个随机的user_token的值，用户每次登录时都要将user_token一起提交。服务器收到请求后，会优先做token的检查，再进行sql查询。但是如果用更复杂的方法，每次先抓取当前页面Token值再随即进行字典式爆破，仍可以实现破解。

（2）加入账号锁定机制。多次登录失败后，账号会锁定一段时间，那么暴力破解就无法继续。例如错误5次，账号会限制登录1天。

（3）设计安全的验证码进行认证登录：安全的流程＋复杂而又可用的图像。

  （4）用户设置复杂的密码，并进行双因素身份认证。设置复杂的密码可以大大提高破解的成本，使得暴力破解难以实现。

 

### **2.** **SQL Injection**（SQL注入）

SQL注入的原因，表面上说是因为拼接字符串，构成SQL语句，没有使用 SQL语句预编译，绑定变量。但是更深层次的原因是，将用户输入的字符串，当成了 “SQL语句” 来执行。

因此针对这一漏洞，防御措施为：

（1）采用SQL语句预编译和绑定变量。采用PreparedStatement将SQL语句预先编译好，也就是SQL引擎会预先进行语法分析，产生语法树，生成执行计划。也就是说，后面无论输入什么参数，都不会影响该SQL语句的语法结构，因为语法分析已经完成了。所以即使后面输入了这些SQL命令，也不会被当成SQL命令来执行了，因为这些SQL命令的执行， 必须先的通过语法分析，生成执行计划，既然语法分析已经完成，已经预编译过了，那么后面输入的参数，是绝对不可能作为SQL命令来执行的，只会被当做字符串字面值参数。所以SQL语句预编译可以防御SQL注入。

（2）采用正则表达式检查SQL语句。例如，检测SQL meta-characters的正则表达式 ：

`/(\%27)|(\')|(\-\-)|(\%23)|(#)/ix`

修正检测SQL meta-characters的正则表达式 ：

`/((\%3D)|(=))[^\n]*((\%27)|(\')|(\-\-)|(\%3B)|(:))/i`

（3）加入SQL字符转义逻辑。例如在DVWA中，Medium级别的代码就相比Low级别增加了mysql_real_escape_string函数，这个函数会对字符串中的特殊符号（例如x00，n，r， ，x1a等）进行转义，基本上能够抵御SQL注入攻击。同时，$pass做了MD5校验，杜绝了通过参数password进行SQL注入的可能性。